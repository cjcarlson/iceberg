![banner](https://github.com/cjcarlson/iceberg/blob/master/Banner.png)

# Iceberg

## Carlson, Albery, et al.: Climate change will drive novel cross-species viral transmission

This repo relates to this preprint: https://www.biorxiv.org/content/10.1101/2020.01.24.918755v1

The study can be separated into two conceptual and practical stages: generating and processing species distribution models (SDMs), and then using them to predict how they alter viral ecology as a result of climate change.

1. The study uses species distribution models (SDMs) to predict the movement of mammal species' ranges between 2020 and 2070, predicts how these movements are likely to result in novel encounters between mammal species that currently have no overlapping ranges.

2. After projecting species' movements, we used a published model of intersepecific viral sharing (Albery et al., 2020: https://www.nature.com/articles/s41467-020-16153-4) to estimate how these movements are likely to alter viral sharing patterns in the future.

This repo uses the following datasets:

- The IUCN species ranges ().  
- The PanTheria mammalian phenotypic dataset ().  
- The Olival et al. (2017) host-virus association dataset ().  
- The Fritz et al (2007) mammalian phylogenetic supertree ().

- It takes in rasters generated by an SDM protocol run by Cory Merow, across >3000 species, first for the present day and then for four future representative concentration pathways (RCPs). This was repeated using nine different climate models, totalling 1 current prediction and 4x9 = 36 future predictions per species. 37x3000 = 111,000 rasters before our processing begins.

This repo is organised as follows:

- For each climate model, the code in the folder `Iceberg Code/1_ENM Code` will:

### For the currents:
-- Load the rasters for each species and resample them to a global Mercator projection.  
-- Clip them to within 1000km of their IUCN ranges and ensuring that they remain within the same continent.  
-- Clip each species by their known habitat use.  
-- Buffer each species' current range by its known dispersal ability, to allow us to control for their ability to move towards their future ranges.  
-- write out data frames (`GretCDFs`) of X and Y coordinates alongside presence/absence for each of the stages of the processing pipeline.  

### For the futures:
-- Load and resample the rasters, as with the currents.  
-- Clip the futures by their habitat use, as with the currents.  
-- Use the dispersal buffer generated by the currents to prevent species from moving further than is biologically plausible.  
-- Write out data frames (`GretCDFs`), as with the currents.  

- For each climate model, the code in the folder `Iceberg Code/2_GAMM Code` will:

-- `0_Master Iceberg.R`: Loop through the rest of the code.  
-- `1_Iceberg Spatial.R`: Import the `GretCDFs` and use them to calculate current and future overlap between species' ranges. This makes use of the `PairsWisely` function from the `SpRanger` package, per Albery et al. (2020).  
-- `2_Iceberg Data Import.R`: Import the accessory phenotypic data used for the GAMMs, including PanTheria and the host-virus association dataset.
-- `3_Iceberg GAMs.R`  
-- `4_Iceberg Prediction.R`  
-- `5_Iceberg Mapping.R`  
-- `6_Iceberg Submaps.R`  
-- `6b_Order New Encounters.R`  
-- `6c_Range Changes.R`  
-- `7_New Encounter GAMs.R`  
-- `8_Individual Reps Iceberg Display Outputs.R`  
-- `8b_Individual Reps Extended Data Figures.R`  
-- `8c_Summary Iceberg Display Outputs.R`  
-- `9_Text Numbers.R`  
-- `9X_Numbers that Colin needs in main text.R`  








